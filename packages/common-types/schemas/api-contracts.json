{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://caption-editor.com/schemas/api-contracts.json",
  "title": "API Contracts",
  "description": "API request and response schemas for Caption Editor",
  "definitions": {
    "TranscriptionRequest": {
      "type": "object",
      "properties": {
        "videoUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL to the video file for transcription"
        },
        "videoFile": {
          "type": "string",
          "description": "Base64 encoded video file content"
        },
        "language": {
          "type": "string",
          "pattern": "^[a-z]{2}(-[A-Z]{2})?$",
          "default": "en",
          "description": "Target language for transcription"
        },
        "options": {
          "type": "object",
          "properties": {
            "speakerDiarization": {
              "type": "boolean",
              "default": false,
              "description": "Enable speaker identification"
            },
            "punctuation": {
              "type": "boolean", 
              "default": true,
              "description": "Include punctuation in transcription"
            },
            "profanityFilter": {
              "type": "boolean",
              "default": false,
              "description": "Filter profanity from transcription"
            }
          },
          "additionalProperties": false
        }
      },
      "oneOf": [
        {"required": ["videoUrl"]},
        {"required": ["videoFile"]}
      ],
      "additionalProperties": false
    },
    "TranscriptionResponse": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["queued", "processing", "completed", "failed"],
          "description": "Current status of the transcription job"
        },
        "jobId": {
          "type": "string",
          "description": "Unique identifier for the transcription job"
        },
        "captions": {
          "$ref": "caption-file.json",
          "description": "Transcribed captions (only when status is completed)"
        },
        "message": {
          "type": "string",
          "description": "Human-readable status message"
        },
        "error": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "description": "Error code"
            },
            "message": {
              "type": "string", 
              "description": "Error message"
            },
            "details": {
              "type": "object",
              "description": "Additional error details"
            }
          },
          "required": ["code", "message"],
          "additionalProperties": false
        }
      },
      "required": ["status", "message"],
      "additionalProperties": false
    },
    "HealthResponse": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["healthy", "unhealthy"],
          "description": "Health status"
        },
        "message": {
          "type": "string",
          "description": "Health status message"
        },
        "version": {
          "type": "string",
          "description": "API version"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Health check timestamp"
        }
      },
      "required": ["status", "message"],
      "additionalProperties": false
    }
  }
}